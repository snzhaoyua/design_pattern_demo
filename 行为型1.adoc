:hardbreaks-option:
=== Template Method æ¨¡æ¿æ–¹æ³•æ¨¡å¼
[quote]
æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ­¥éª¤ï¼Œå¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°æ–¹å¼ã€‚è¿™æ ·ï¼Œä¸åŒçš„å­ç±»å°±å¯ä»¥å®šä¹‰å‡ºä¸åŒçš„æ­¥éª¤ï¼Œè€Œä¸æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚

æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå®šä¹‰ä¸€ä¸ªâ€œéª¨æ¶â€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›æŠ½è±¡æ–¹æ³•å’Œä¸€äº›å…·ä½“æ–¹æ³•ï¼Œå…·ä½“æ–¹æ³•è°ƒç”¨æŠ½è±¡æ–¹æ³•æ¥å®ŒæˆæŸä¸ªæµç¨‹ã€‚å­ç±»ç»§æ‰¿æˆ–å®ç°è¿™ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œé‡å†™æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå®šåˆ¶è‡ªå·±çš„é€»è¾‘ã€‚

.æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯
* æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒã€‚
* é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³•ã€‚
* éœ€è¦æ§åˆ¶å­ç±»çš„æ‰©å±•ï¼Œå³å­ç±»åªèƒ½é‡å†™ç‰¹å®šçš„æ–¹æ³•ã€‚

.ä¼˜ç‚¹
* å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚
* æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚
* è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚

.ç¼ºç‚¹
* æ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚
* çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•æ•°é‡è¿‡å¤šï¼Œä¼šå½±å“ä»£ç å¯è¯»æ€§å’Œè¿è¡Œæ•ˆç‡ã€‚

æ¨¡æ¿æ–¹æ³•æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶è®©å­ç±»å®ç°å…¶ä¸­çš„æŸäº›æ­¥éª¤ã€‚ä½†æ˜¯å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š

* æ¨¡æ¿æ–¹æ³•ä½¿ç”¨ç»§æ‰¿æ¥æ”¹å˜ç®—æ³•çš„ä¸€éƒ¨åˆ†ï¼Œç­–ç•¥ä½¿ç”¨ç»„åˆæ¥æ•´ä½“æ›¿æ¢ç®—æ³•ã€‚
* æ¨¡æ¿æ–¹æ³•åœ¨çˆ¶ç±»ä¸­å®šä¹‰äº†ç®—æ³•çš„æ¡†æ¶ï¼Œåœ¨å­ç±»ä¸­å®ç°äº†å…·ä½“æ­¥éª¤ï¼›ç­–ç•¥åœ¨çˆ¶ç±»ä¸­å®šä¹‰äº†æ‰€æœ‰å¯èƒ½è¢«æ›¿æ¢çš„è¡Œä¸ºï¼Œåœ¨å­ç±»ä¸­é€‰æ‹©äº†å…¶ä¸­ä¸€ç§è¡Œä¸ºã€‚
* æ¨¡æ¿æ–¹æ³•å¯¹å­ç±»çš„æ‰©å±•æœ‰é™åˆ¶ï¼ˆåªèƒ½é‡å†™ç‰¹å®šçš„æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œç­–ç•¥å¯¹å­ç±»çš„æ‰©å±•æ›´çµæ´»ï¼ˆå¯ä»¥å¢åŠ æ–°çš„è¡Œä¸ºï¼‰ã€‚

.JDKä¸­æœ‰å¾ˆå¤šä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä¾‹å­
* java.util.AbstractListã€java.util.AbstractSetã€java.util.AbstractMapç­‰æŠ½è±¡é›†åˆç±»éƒ½å®šä¹‰äº†å¾ˆå¤šé€šç”¨æ“ä½œï¼Œå¹¶ç•™ç»™å­ç±»å®ç°ä¸€äº›å…³é”®æ“ä½œï¼ˆå¦‚getã€setã€addç­‰ï¼‰ï¼›
* java.io.InputStreamã€java.io.OutputStreamã€java.io.Readerã€java.io.Writerç­‰æŠ½è±¡æµç±»éƒ½å®šä¹‰äº†å¾ˆå¤šé€šç”¨æ“ä½œï¼Œå¹¶ç•™ç»™å­ç±»å®ç°ä¸€äº›å…³é”®æ“ä½œï¼ˆå¦‚readã€writeç­‰ï¼‰ï¼›
* javax.servlet.http.HttpServletä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚å®ƒå®šä¹‰äº†service()æ–¹æ³•ä½œä¸ºå¤„ç†è¯·æ±‚å’Œå“åº”çš„æ¡†æ¶ï¼Œå¹¶è°ƒç”¨doGet()ã€doPost()ç­‰æŠ½è±¡æ–¹æ³•è®©å­ç±»å®ç°å…·ä½“é€»è¾‘ã€‚

.ç±»å›¾
[source,text]
----
    +-----------------+
    | AbstractClass   |
    +-----------------+
    | templateMethod()|
    | +operation1()   |
    | #operation2()   |
    | #operation3()   |
    | #operation4()   |
    +-----------------+
            /_\
             |
             |
    +-----------------+
    | ConcreteClass1  |
    +-----------------+
    | #operation2()   |
    | #operation4()   |
    +-----------------+
----

.ç¤ºä¾‹ä»£ç 
[source,java]
----
// å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªç®—æ³•çš„æ¡†æ¶
public abstract class AbstractClass {
    // å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼ŒåŒ…å«ä¸€äº›æ­¥éª¤
    public final void templateMethod() {
        step1();
        step2();
        step3();
    }

    // å®šä¹‰ä¸€äº›æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å®ç°
    protected abstract void step1();
    protected abstract void step2();
    protected abstract void step3();
}

// å®šä¹‰ä¸€ä¸ªå…·ä½“å­ç±»ï¼Œç»§æ‰¿æŠ½è±¡ç±»ï¼Œå¹¶å®ç°æŠ½è±¡æ–¹æ³•
public class ConcreteClass extends AbstractClass {
    @Override
    protected void step1() {
        System.out.println("ConcreteClass: step1");
    }

    @Override
    protected void step2() {
        System.out.println("ConcreteClass: step2");
    }

    @Override
    protected void step3() {
        System.out.println("ConcreteClass: step3");
    }
}

// å®¢æˆ·ç«¯æµ‹è¯•ä»£ç 
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå…·ä½“å­ç±»å¯¹è±¡
        AbstractClass concreteClass = new ConcreteClass();
        // è°ƒç”¨æ¨¡æ¿æ–¹æ³•
        concreteClass.templateMethod();
    }
}
// è¾“å‡ºç»“æœä¸ºï¼š
//
// ConcreteClass: step1
// ConcreteClass: step2
// ConcreteClass: step3
----

===  Command å‘½ä»¤æ¨¡å¼
[quote]
å‘½ä»¤æ¨¡å¼æ˜¯ä¸€ç§æ•°æ®é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚å®ƒå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°å¯¹å‘½ä»¤è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ å’Œç®¡ç†ã€‚

.å‘½ä»¤æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯
* éœ€è¦å°†è¯·æ±‚è€…å’Œæ‰§è¡Œè€…è§£è€¦çš„æƒ…å†µï¼Œä¾‹å¦‚éœ€è¦å¯¹è¡Œä¸ºè¿›è¡Œè®°å½•ã€æ’¤é”€æˆ–é‡åšã€äº‹åŠ¡ç­‰å¤„ç†æ—¶ã€‚
* éœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€ (Undo)æ“ä½œå’Œæ¢å¤ (Redo)æ“ä½œã€‚
* éœ€è¦å°†ä¸€ç»„è¡Œä¸ºæŠ½è±¡ä¸ºå¯¹è±¡ï¼Œå®ç°äºŒè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚

.å‘½ä»¤æ¨¡å¼çš„ä¼˜ç‚¹æœ‰
* é™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚
* æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ åˆ°ç³»ç»Ÿä¸­å»ã€‚
* å¯ä»¥å®ç°å®å‘½ä»¤ï¼Œå³ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚

.å‘½ä»¤æ¨¡å¼çš„ç¼ºç‚¹æœ‰
* ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚
* å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§å’Œç†è§£éš¾åº¦ã€‚

å‘½ä»¤æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯å°†ä¸€ç³»åˆ—ç®—æ³•æˆ–è¡Œä¸ºå°è£…æˆå¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬çš„åŒºåˆ«åœ¨äºæ˜¯å¦å«æœ‰æ¥æ”¶è€…ã€‚å‘½ä»¤æ¨¡å¼å«æœ‰æ¥æ”¶è€…ï¼Œå³æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ï¼Œè€Œç­–ç•¥æ¨¡å¼ä¸å«æœ‰æ¥æ”¶è€…ï¼Œåªæ˜¯å®šä¹‰äº†ä¸€ç»„å¯æ›¿æ¢çš„ç®—æ³•æˆ–ç­–ç•¥ã€‚

.JDKä¸­æœ‰è¿™ä¸ªæ¨¡å¼çš„ä¾‹å­
ä¾‹å¦‚java.lang.Runnableæ¥å£å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘½ä»¤æ¨¡å¼ã€‚Runnableæ‹…å½“å‘½ä»¤çš„è§’è‰²ï¼ŒThreadå……å½“çš„æ˜¯è°ƒç”¨è€…ï¼Œstartæ–¹æ³•å°±æ˜¯å…¶æ‰§è¡Œæ–¹æ³•ã€‚


.ç±»å›¾
[source,text]
----
// å‘½ä»¤æ¨¡å¼çš„ç±»å›¾ï¼Œä½¿ç”¨å­—ç¬¦æ‹¼æ¥å‡ºæ¥
// + è¡¨ç¤ºå…¬å…±æˆå‘˜ï¼Œ - è¡¨ç¤ºç§æœ‰æˆå‘˜ï¼Œ <> è¡¨ç¤ºèšåˆå…³ç³»

    +---------------------+
    |     Invoker        |
    +---------------------+
    | -command: Command  |
    +---------------------+
    | +setCommand(c)     |
    | +executeCommand()  |
    +---------------------+
              |
              |
              v
+---------------------+       +---------------------+
|     Command        |<>------|     Receiver       |
+---------------------+       +---------------------+
|                     |       |                     |
+---------------------+       +---------------------+
| +execute()          |       | +action()           |
+---------------------+       +---------------------+
      / \
      ---
       |
   +---+---------------------------------+
   |                                     |
   v                                     v
+---------------------+      +---------------------+
| ConcreteCommandA   |      | ConcreteCommandB   |
+---------------------+      +---------------------+
| -receiver: Receiver |      | -receiver: Receiver |
+---------------------+      +---------------------+
| +execute()          |      | +execute()          |
+---------------------+      +---------------------+
å…¶ä¸­ï¼ŒInvokeræ˜¯è°ƒç”¨è€…è§’è‰²ï¼ŒCommandæ˜¯å‘½ä»¤è§’è‰²ï¼ŒReceiveræ˜¯æ¥æ”¶è€…è§’è‰²ï¼ŒConcreteCommandæ˜¯å…·ä½“å‘½ä»¤è§’è‰²ã€‚
----

.ç¤ºä¾‹ä»£ç 
[source,java]
----
//å®šä¹‰å‘½ä»¤æ¥å£
public interface Command {
    void execute();
}

//å®šä¹‰å…·ä½“å‘½ä»¤ç±»ï¼Œå®ç°å‘½ä»¤æ¥å£ï¼ŒæŒæœ‰æ¥æ”¶è€…å¯¹è±¡
public class LightOnCommand implements Command {
    private LightReceiver light; //æ¥æ”¶è€…å¯¹è±¡

    public LightOnCommand(LightReceiver light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.on(); //è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•
    }
}

public class LightOffCommand implements Command {
    private LightReceiver light; //æ¥æ”¶è€…å¯¹è±¡

    public LightOffCommand(LightReceiver light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.off(); //è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•
    }
}

//å®šä¹‰æ¥æ”¶è€…ç±»ï¼ŒçŸ¥é“å¦‚ä½•å®æ–½å’Œæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ç›¸å…³çš„æ“ä½œ
public class LightReceiver {
    public void on() {
        System.out.println("ç”µç¯æ‰“å¼€äº†...");
    }

    public void off() {
        System.out.println("ç”µç¯å…³é—­äº†...");
    }
}

//å®šä¹‰è°ƒç”¨è€…ç±»ï¼Œè´Ÿè´£è°ƒç”¨å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œç›¸å…³çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•
public class RemoteController {
    private Command[] onCommands; //å¼€æŒ‰é’®çš„å‘½ä»¤æ•°ç»„
    private Command[] offCommands; //å…³æŒ‰é’®çš„å‘½ä»¤æ•°ç»„

    public RemoteController() {
        onCommands = new Command[5];
        offCommands = new Command[5];
        for (int i = 0; i < 5; i++) {
            onCommands[i] = new NoCommand(); //åˆå§‹åŒ–ä¸ºç©ºå‘½ä»¤ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸
            offCommands[i] = new NoCommand();
        }
    }

    //ç»™æŒ‰é’®è®¾ç½®éœ€è¦çš„å‘½ä»¤
    public void setCommand(int no, Command onCommand, Command offCommand) {
        onCommands[no] = onCommand;
        offCommands[no] = offCommand;
    }

    //æŒ‰ä¸‹å¼€æŒ‰é’®
    public void onButtonWasPushed(int no) {
        onCommands[no].execute(); //æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤å¹¶æ‰§è¡Œ
    }

    //æŒ‰ä¸‹å…³æŒ‰é’®
    public void offButtonWasPushed(int no) {
        offCommands[no].execute(); //æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤å¹¶æ‰§è¡Œ
    }
}

//å®šä¹‰ä¸€ä¸ªç©ºå‘½ä»¤ï¼Œç”¨äºåˆå§‹åŒ–é¥æ§å™¨ä¸Šçš„æ¯ä¸ªæŒ‰é’®ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸å’Œåˆ¤æ–­é€»è¾‘
public class NoCommand implements Command {

	@Override
	public void execute() {
		// do nothing
	}
}

//æµ‹è¯•ç±»ï¼Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯ä½¿ç”¨é¥æ§å™¨æ“ä½œç”µç¯
public class Client {

	public static void main(String[] args) {
		//åˆ›å»ºç”µç¯çš„å¯¹è±¡(æ¥æ”¶è€…)
		LightReceiver lightReceiver = new LightReceiver();

		//åˆ›å»ºç”µç¯ç›¸å…³çš„å¼€å…³å‘½ä»¤
		LightOnCommand lightOnCommand = new LightOnCommand(lightReceiver);
		LightOffCommand lightOffCommand = new LightOffCommand(lightReceiver);

		//éœ€è¦ä¸€ä¸ªé¥æ§å™¨(è°ƒç”¨è€…)
		RemoteController remoteController = new RemoteController();

		//ç»™æˆ‘ä»¬çš„é¥æ§å™¨è®¾ç½®å‘½ä»¤, æ¯”å¦‚ no = 0 æ˜¯ç”µç¯çš„å¼€å’Œå…³çš„æ“ä½œ
		remoteController.setCommand(0, lightOnCommand, lightOffCommand);

		System.out.println("--------æŒ‰ä¸‹ç¯çš„å¼€æŒ‰é’®-----------");
		remoteController.onButtonWasPushed(0);
		System.out.println("--------æŒ‰ä¸‹ç¯çš„å…³æŒ‰é’®-----------");
		remoteController.offButtonWasPushed(0);
		//å¯ä»¥æ·»åŠ å…¶ä»–è®¾å¤‡å’Œå¯¹åº”çš„å‘½ä»¤ï¼Œå®ç°å¤šç§åŠŸèƒ½
}
----
è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‘½ä»¤æ¨¡å¼æ¥å®ç°ä¸€ä¸ªé¥æ§å™¨æ§åˆ¶ä¸åŒè®¾å¤‡ï¼ˆå¦‚ç”µç¯ï¼‰çš„åŠŸèƒ½ã€‚


=== Iterator è¿­ä»£å™¨æ¨¡å¼
[quote]
è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºé›†åˆæä¾›äº†ä¸€ä¸ªéå†å…ƒç´ çš„æ–¹å¼ï¼Œåˆä¸ä¼šæš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚è¿­ä»£å™¨æ¨¡å¼å¯ä»¥è®©ä½ åœ¨ä¸å…³å¿ƒé›†åˆçš„åº•å±‚ç»“æ„ï¼ˆåˆ—è¡¨ã€æ ˆã€æ ‘ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼ŒæŒ‰é¡ºåºè®¿é—®é›†åˆä¸­çš„å…ƒç´ ã€‚

.è¿­ä»£å™¨æ¨¡å¼çš„ä¼˜ç‚¹
* å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡
* è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»
* åœ¨åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå†
* åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç 

.è¿­ä»£å™¨æ¨¡å¼çš„ç¼ºç‚¹
ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§

.è¿­ä»£å™¨æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯
* è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º
* éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼
* ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£

è¿­ä»£å™¨æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰ä¸€ä¸ªæ¥å£æ¥å®ç°å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ä½†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ç”¨äºåœ¨ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œè€Œè¿­ä»£å™¨æ¨¡å¼æ˜¯ç”¨äºåœ¨ä¸€ä¸ªé›†åˆä¸­æŒ‰ç…§ä¸€å®šé¡ºåºè®¿é—®å…ƒç´ ã€‚

.jdkä¸­ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„ä¾‹å­
JDKä¸­æœ‰å¾ˆå¤šä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„ä¾‹å­ï¼Œä¾‹å¦‚java.util.Iteratoræ¥å£å’Œjava.util.ListIteratoræ¥å£ï¼Œä»¥åŠå®ƒä»¬çš„å®ç°ç±»ã€‚è¿™äº›æ¥å£å’Œç±»éƒ½æä¾›äº†å¯¹é›†åˆè¿›è¡Œéå†å’Œæ“ä½œçš„æ–¹æ³•ï¼Œé€šå¸¸è¿™äº›è¿­ä»£å™¨éƒ½æ˜¯åœ¨å®¹å™¨ç±»çš„å†…éƒ¨ç±»ä¸­å®ç°çš„ã€‚

.ç±»å›¾
[source,text]
----
+----------------+        +----------------+
|    Iterator    |<-------|  Container     |
+----------------+        +----------------+
| +hasNext():bool|        |+getIterator()  |
| +next():Object |        |                |
+----------------+        +----------------+
       ^                         ^
       |                         |
       |                         |
+----------------+        +-----------------+
|ConcreteIterator|        |ConcreteAggregate|
+----------------+        +-----------------+
| -aggregate     |------->|-items           |
| -current       |        |                 |
+----------------+        +-----------------+
| +hasNext():bool|        |+getIterator()   |
| +next():Object |        |                 |
+----------------+        +-----------------+
----

.ç¤ºä¾‹ä»£ç 
[source,java]
----
// è¿­ä»£å™¨æ¥å£
public interface Iterator<T> {
  // åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
  public boolean hasNext();
  // è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ 
  public T next();
}

// é›†åˆæ¥å£
public interface Container<T> {
  // è·å–è¿­ä»£å™¨å¯¹è±¡
  public Iterator<T> getIterator();
}

// å…·ä½“çš„è¿­ä»£å™¨ç±»ï¼Œå®ç°äº†è¿­ä»£å™¨æ¥å£
public class ConcreteIterator<T> implements Iterator<T> {
  // æŒæœ‰ä¸€ä¸ªå¯¹é›†åˆå¯¹è±¡çš„å¼•ç”¨
  private Container<T> container;
  // è®°å½•å½“å‰å…ƒç´ çš„ç´¢å¼•
  private int index;

  public ConcreteIterator(Container<T> container) {
    this.container = container;
    this.index = 0;
  }

  @Override
  public boolean hasNext() {
    return index < container.size();
  }

  @Override
  public T next() {
    if (hasNext()) {
      return container.get(index++);
    } else {
      return null;
    }
  }
}

// å…·ä½“çš„é›†åˆç±»ï¼Œå®ç°äº†é›†åˆæ¥å£
public class ConcreteContainer<T> implements Container<T> {
  // ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨å…ƒç´ 
  private T[] items;

  public ConcreteContainer(T[] items) {
    this.items = items;
  }

  @Override
  public Iterator<T> getIterator() {
    return new ConcreteIterator<>(this);
  }

  // è·å–é›†åˆçš„å¤§å°
  public int size() {
    return items.length;
  }

  // æ ¹æ®ç´¢å¼•è·å–å…ƒç´ 
  public T get(int index) {
    return items[index];
  }
}

// æµ‹è¯•ç±»
public class Test {

  public static void main(String[] args) {
    // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä½œä¸ºå…ƒç´ æº
    String[] names = {"Alice", "Bob", "Charlie", "David"};
    // åˆ›å»ºä¸€ä¸ªå…·ä½“çš„é›†åˆå¯¹è±¡ï¼Œå¹¶ä¼ å…¥å…ƒç´ æº
    Container<String> container = new ConcreteContainer<>(names);
    // è·å–ä¸€ä¸ªå…·ä½“çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå¹¶éå†é›†åˆä¸­çš„å…ƒç´ 
    Iterator<String> iterator = container.getIterator();
    while (iterator.hasNext()) {
      System.out.println(iterator.next());
    }
   }
}
----

=== Observer è§‚å¯Ÿè€…æ¨¡å¼
[quote]
è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸å…³ä¾èµ–å¯¹è±¡çš†å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚

è§‚å¯Ÿè€…æ¨¡å¼åˆå«åšå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€æ¨¡å‹-è§†å›¾æ¨¡å¼ã€æº-ç›‘å¬å™¨æ¨¡å¼æˆ–ä»å±è€…æ¨¡å¼1ã€‚è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«å››ä¸ªè§’è‰²ï¼šç›®æ ‡åˆç§°ä¸ºä¸»é¢˜ï¼Œå®ƒæ˜¯æŒ‡è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼›å…·ä½“ç›®æ ‡æ˜¯ç›®æ ‡ç±»çš„å­ç±»ï¼Œé€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œå½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼›è§‚å¯Ÿè€…å°†å¯¹è§‚å¯Ÿç›®æ ‡çš„æ”¹å˜åšå‡ºååº”ï¼›åœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜å‚¨å…·ä½“è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚

.è§‚å¯Ÿè€…æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯
* ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®æˆ–çŠ¶æ€æ›´æ–°éœ€è¦å…¶å®ƒå¯¹è±¡åŒæ­¥æ›´æ–°æ—¶ï¼›
* ç³»ç»Ÿå­˜åœ¨äº‹ä»¶å¤šçº§è§¦å‘æ—¶ï¼›
* ä¸€ä¸ªå¯¹è±¡ä»…éœ€è¦å°†è‡ªå·±çš„æ›´æ–°é€šçŸ¥ç»™å…¶å®ƒå¯¹è±¡è€Œä¸éœ€è¦çŸ¥é“å…¶å®ƒå¯¹è±¡ç»†èŠ‚æ—¶ï¼Œå¦‚æ¶ˆæ¯æ¨é€ï¼›
* è·¨ç³»ç»Ÿçš„æ¶ˆæ¯äº¤æ¢åœºæ™¯ï¼Œå¦‚é€šä¿¡è¿‡ç¨‹ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†æœºåˆ¶ã€‚

.è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹
* è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æŠ½è±¡è€¦åˆçš„ï¼›
* å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ï¼›
* æ”¯æŒå¹¿æ’­é€šä¿¡ã€‚

.è§‚å¯Ÿè€…æ¨¡å¼çš„ç¼ºç‚¹
* å¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡æœ‰å¾ˆå¤šçš„ç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼›
* å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼›
* è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚
* æ ¹æ®è¢«è§‚å¯Ÿè€…å‘è§‚å¯Ÿè€…æ¨é€ä¿¡æ¯æ–¹å¼ä¸åŒï¼Œè¿˜å¯ä»¥åˆ†ä¸ºæ¨æ¨¡å‹å’Œæ‹‰æ¨¡å‹ã€‚æ¨æ¨¡å‹æ˜¯æŒ‡è¢«è§‚å¯Ÿè€…å‘æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å‘é€ç›¸åŒä¿¡æ¯ï¼›æ‹‰æ¨¡å‹æ˜¯æŒ‡è¢«è§‚å¯Ÿè€…åªå‘é€ç®€å•ä¿¡æ¯ç»™æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…ï¼Œå¦‚æœæŸä¸ªç‰¹å®šè®¢é˜…äº†è¯¥ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä¸»åŠ¨åˆ°è¢«è®¢é˜…æ–¹è·å–æ›´è¯¦ç»†ä¿¡æ¯ã€‚

åœ¨ JDK ä¸­æœ‰è¿™ä¸ªæ¨¡å¼çš„ä¾‹å­ï¼Œæ¯”å¦‚ java.util.Observable ç±»å’Œ java.util.Observer æ¥å£å°±å®ç°äº†ç®€å•çš„åŸºäºæ‹‰æ¨¡å‹ï¼ˆpullï¼‰æ–¹å¼å®ç°äº† Observer æ¨¡å¼ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªç±»å·²ç»åœ¨ JDK 9 ä¸­è¢«åºŸå¼ƒäº†ã€‚

[.text-right]
ğŸ§ME: ä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªç±»è¢«åºŸå¼ƒäº†ï¼Ÿæœ‰ä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆå—ï¼Ÿ

ğŸ™‚BING: å› ä¸ºå®ƒä»¬ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”ä¸æ”¯æŒæ³›å‹ï¼Œå¯¼è‡´ä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ä¹Ÿä¸å®‰å…¨ã€‚å¦å¤–ï¼Œå®ƒä»¬çš„è®¾è®¡ä¹Ÿä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼ï¼Œè€Œ JDK 9 å¼•å…¥äº†æ›´å¤šçš„å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ lambda è¡¨è¾¾å¼å’Œæµå¼ APIã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªç±»è¢«è®¤ä¸ºæ˜¯è¿‡æ—¶çš„ï¼Œä¸æ¨èä½¿ç”¨ ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ java.beans.PropertyChangeListener æ¥å£æˆ–è€… java.util.concurrent.Flow ç±» ï¼Œè¿™äº›åœ¨ JDK 8 ä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œç¤ºä¾‹ä»£ç åæ–‡é™„ä¸Šã€‚

è¿™ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œå…·ä½“å“ªä¸ªæ›´å¥½ç”¨è¿˜è¦çœ‹å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œjava.beans.PropertyChangeListener æ¥å£æ¯”è¾ƒé€‚åˆç”¨äºç›‘å¬ JavaBean å¯¹è±¡çš„å±æ€§å˜åŒ–ï¼Œè€Œ java.util.concurrent.Flow ç±»æ¯”è¾ƒé€‚åˆç”¨äºå®ç°å“åº”å¼æµç¼–ç¨‹ï¼Œå³åŸºäºå¼‚æ­¥ã€éé˜»å¡ã€èƒŒå‹çš„æ•°æ®æµå¤„ç†ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå“åº”å¼æµç¼–ç¨‹çš„å†…å®¹ï¼Œä½ å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚


.ç±»å›¾
[source,text]
----

----

.ç¤ºä¾‹ä»£ç 2 ä½¿ç”¨ java.beans.PropertyChangeListener æ¥å£
[source,java]
----
// å®šä¹‰ä¸€ä¸ª JavaBean ç±»ï¼Œæœ‰ä¸€ä¸ª name å±æ€§
class Person {
    private String name;
    private PropertyChangeSupport support; // ç”¨äºç®¡ç†å±æ€§å˜åŒ–çš„ç›‘å¬å™¨

    public Person() {
        support = new PropertyChangeSupport(this);
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        String oldName = this.name;
        this.name = name;
        support.firePropertyChange("name", oldName, name); // è§¦å‘å±æ€§å˜åŒ–äº‹ä»¶
    }

    // æ·»åŠ å±æ€§å˜åŒ–ç›‘å¬å™¨
    public void addPropertyChangeListener(PropertyChangeListener listener) {
        support.addPropertyChangeListener(listener);
    }

    // ç§»é™¤å±æ€§å˜åŒ–ç›‘å¬å™¨
    public void removePropertyChangeListener(PropertyChangeListener listener) {
        support.removePropertyChangeListener(listener);
    }
}

// å®šä¹‰ä¸€ä¸ªå±æ€§å˜åŒ–ç›‘å¬å™¨ç±»ï¼Œå®ç° java.beans.PropertyChangeListener æ¥å£
class NameChangeListener implements PropertyChangeListener {

    @Override
    public void propertyChange(PropertyChangeEvent evt) {
        // å½“è¢«ç›‘å¬å¯¹è±¡çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰“å°æ—§å€¼å’Œæ–°å€¼
        System.out.println("Name changed from " + evt.getOldValue() + " to " + evt.getNewValue());
    }
}

// æµ‹è¯•ç±»
public class Test {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ª JavaBean å¯¹è±¡
        Person person = new Person();
        // åˆ›å»ºä¸€ä¸ªå±æ€§å˜åŒ–ç›‘å¬å™¨å¯¹è±¡
        NameChangeListener listener = new NameChangeListener();
        // ç»™ JavaBean å¯¹è±¡æ·»åŠ å±æ€§å˜åŒ–ç›‘å¬å™¨
        person.addPropertyChangeListener(listener);
        // æ”¹å˜ JavaBean å¯¹è±¡çš„ name å±æ€§ï¼Œè§¦å‘å±æ€§å˜åŒ–äº‹ä»¶
        person.setName("Alice");
        person.setName("Bob");
    }
}
----

.ç¤ºä¾‹ä»£ç 3 ä½¿ç”¨ java.util.concurrent.Flow ç±»
[source,java]
----
// å®šä¹‰ä¸€ä¸ªå‘å¸ƒè€…ç±»ï¼Œå®ç° java.util.concurrent.Flow.Publisher æ¥å£ï¼Œç”¨äºå‘å¸ƒæ•´æ•°åºåˆ—
class IntPublisher implements Flow.Publisher<Integer> {

    private List<Flow.Subscriber<? super Integer>> subscribers; // è®¢é˜…è€…åˆ—è¡¨

    public IntPublisher() {
        subscribers = new ArrayList<>();
    }

    @Override
    public void subscribe(Flow.Subscriber<? super Integer> subscriber) {
        // å½“æœ‰è®¢é˜…è€…è®¢é˜…æ—¶ï¼Œå°†å…¶åŠ å…¥åˆ—è¡¨ï¼Œå¹¶å‘é€è®¢é˜…ç¡®è®¤ä¿¡å·
        subscribers.add(subscriber);
        subscriber.onSubscribe(new IntSubscription(subscriber));
    }

    // å®šä¹‰ä¸€ä¸ªè®¢é˜…ç±»ï¼Œå®ç° java.util.concurrent.Flow.Subscription æ¥å£ï¼Œç”¨äºç®¡ç†è®¢é˜…å…³ç³»å’Œè¯·æ±‚æ•°æ®çš„æ•°é‡
    class IntSubscription implements Flow.Subscription {

        private Flow.Subscriber<? super Integer> subscriber; // è®¢é˜…è€…å¯¹è±¡

        public IntSubscription(Flow.Subscriber<? super Integer> subscriber) {
            this.subscriber = subscriber;
        }

        @Override
        public void request(long n) {
            // å½“è®¢é˜…è€…è¯·æ±‚æ•°æ®æ—¶ï¼Œå‘é€ n ä¸ªæ•´æ•°ç»™å®ƒï¼Œå¹¶å‘é€å®Œæˆä¿¡å·
            for (int i = 1; i <= n; i++) {
                subscriber.onNext(i);
            }
            subscriber.onComplete();
            cancel(); // å–æ¶ˆè®¢é˜…å…³ç³»
        }
        @Override
        public void cancel() {
            // å½“è®¢é˜…è€…å–æ¶ˆè®¢é˜…æ—¶ï¼Œå°†å…¶ä»åˆ—è¡¨ä¸­ç§»é™¤
            subscribers.remove(subscriber);
        }
    }
}

// å®šä¹‰ä¸€ä¸ªè®¢é˜…è€…ç±»ï¼Œå®ç° java.util.concurrent.Flow.Subscriber æ¥å£ï¼Œç”¨äºæ¥æ”¶æ•´æ•°åºåˆ—
class IntSubscriber implements Flow.Subscriber<Integer> {

    private Flow.Subscription subscription; // è®¢é˜…å¯¹è±¡

    @Override
    public void onSubscribe(Flow.Subscription subscription) {
        // å½“æ”¶åˆ°è®¢é˜…ç¡®è®¤ä¿¡å·æ—¶ï¼Œä¿å­˜è®¢é˜…å¯¹è±¡ï¼Œå¹¶è¯·æ±‚ä¸€ä¸ªæ•°æ®
        this.subscription = subscription;
        System.out.println("Subscribed");
        subscription.request(1);
    }

    @Override
    public void onNext(Integer item) {
        // å½“æ”¶åˆ°æ•°æ®æ—¶ï¼Œæ‰“å°æ•°æ®ï¼Œå¹¶è¯·æ±‚ä¸‹ä¸€ä¸ªæ•°æ®
        System.out.println("Received: " + item);
        subscription.request(1);
    }

    @Override
    public void onError(Throwable throwable) {
        // å½“æ”¶åˆ°é”™è¯¯ä¿¡å·æ—¶ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶å–æ¶ˆè®¢é˜…å…³ç³»
        System.out.println("Error: " + throwable.getMessage());
        subscription.cancel();
    }

    @Override
    public void onComplete() {
        // å½“æ”¶åˆ°å®Œæˆä¿¡å·æ—¶ï¼Œæ‰“å°å®Œæˆä¿¡æ¯ï¼Œå¹¶å–æ¶ˆè®¢é˜…å…³ç³»
        System.out.println("Completed");
        subscription.cancel();
    }
}

// æµ‹è¯•ç±»
public class Test {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå‘å¸ƒè€…å¯¹è±¡
        IntPublisher publisher = new IntPublisher();
        // åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…å¯¹è±¡
        IntSubscriber subscriber = new IntSubscriber();
        // è®©è®¢é˜…è€…è®¢é˜…å‘å¸ƒè€…
        publisher.subscribe(subscriber);
    }
}
----

.æ—¶åºå›¾ä¸ç±»å›¾
[source,text]
----
+------------+            +------------+            +------------+
|  Test      |            |  Publisher |            |  Subscriber|
+------------+            +------------+            +------------+
     |                         |                         |
     |------------------------>| subscribe               |
     |                         |                         |
     |                         |------------------------>| onSubscribe
     |                         |                         |
     |                         |<------------------------| request(1)
     |                         |                         |
     |                         |------------------------>| onNext(1)
     |                         |                         |
     |                         |<------------------------| request(1)
     |                         |                         |
     ...                       ...                       ...
     ...                       ...                       ...
     ...                       ...                       ...
     |                         |<------------------------| request(1)
     |                         |                         |
     |                         |------------------------>| onNext(n)
     |                         |                         |
     |                         |--[complete signal]----->| onComplete
     |                         |--[cancel signal]------->| cancel



+---------------------------------+                               +---------------------------------+
|          <<interface>>         |                                |          <<interface>>          |
|        Flow.Publisher<T>       |                                |       Flow.Subscription         |
+---------------------------------+                               +---------------------------------+
| + subscribe(subscriber:T) : v  |                                | + request(n:long) :             |
+---------------------------------+                               | + cancel() : void               |
              ^                                                   +---------------------------------+
              |                                                                 ^
              |                                                                 |
+---------------------------------+                                             |
|          IntPublisher          |                               +---------------------------------+
+---------------------------------+                              |          IntSubscription        |
| - subscribers : List<T>        |                               +---------------------------------+
+---------------------------------+                              | - subscriber : T                |
| + subscribe(subscriber:T) : v  |                               +---------------------------------+
+---------------------------------+                              | + request(n:long) : void        |
                                                                 +---------------------------------+
+---------------------------------+
|          <<interface>>         |
|        Flow.Subscriber<T>      |
+---------------------------------+
| + onSubscribe(subscription:T)  |
| + onNext(item:T) : void        |
| + onError(throwable:Throwable) |
| + onComplete() : void          |
+---------------------------------+
              ^
              |
              |
+---------------------------------+
|          IntSubscriber         |
+---------------------------------+
| - subscription : T             |
+---------------------------------+
| + onSubscribe(subscription:T)  |
| + onNext(item:T) : void        |
| + onError(throwable:Throwable) |
| + onComplete() : void          |
+---------------------------------+
----
