:hardbreaks-option:
=== State çŠ¶æ€æ¨¡å¼
[quote]
çŠ¶æ€æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œè®©ä½ èƒ½åœ¨ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å˜åŒ–æ—¶æ”¹å˜å…¶è¡Œä¸ºï¼Œä½¿å…¶çœ‹ä¸Šå»å°±åƒæ”¹å˜äº†è‡ªèº«æ‰€å±çš„ç±»ä¸€æ ·1ã€‚çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚

.çŠ¶æ€æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯
* å½“ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºæ—¶ã€‚
* å½“ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥æ—¶ã€‚

.çŠ¶æ€æ¨¡å¼çš„ä¼˜ç‚¹
* å°è£…äº†è½¬æ¢è§„åˆ™ï¼Œå°†å„ç§å…·ä½“çš„çŠ¶æ€ç±»æŠ½è±¡å‡ºæ¥ã€‚
* å¢å¼ºäº†ç¨‹åºçš„å¯æ‰©å±•æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå®¹æ˜“æ·»åŠ ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚
* å¢å¼ºäº†ç¨‹åºçš„å°è£…æ€§ï¼Œæ¯ä¸ªçŠ¶æ€çš„æ“ä½œéƒ½è¢«å°è£…åˆ°äº†ä¸€ä¸ªçŠ¶æ€ç±»ä¸­ã€‚

.çŠ¶æ€æ¨¡å¼çš„ç¼ºç‚¹
* çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚
* çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚
* çŠ¶æ€æ¨¡å¼å¯¹"å¼€é—­åŸåˆ™"çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºä»£ç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€ä¿®æ”¹å¯¹åº”ç±»çš„æºä»£ç ã€‚

çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰ä¸€ç»„å¯äº’ç›¸ä»£æ›¿çš„ç®—æ³•æˆ–è€…è¡Œä¸ºæ¥å®ç°æŸä¸ªåŠŸèƒ½ã€‚ ä½†æ˜¯ä»–ä»¬ä¹‹é—´æœ‰ä¸€äº›åŒºåˆ«ï¼š

* ç­–ç•¥æ¨¡å¼ä¸­ï¼Œè¿™ä¸€ç»„ç®—æ³•æˆ–è€…è¡Œä¸ºå®Œæˆçš„æ˜¯åŒä¸€ä¸ªä»»åŠ¡ï¼Œåªæ˜¯ä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼›è€Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œä¸åŒçš„çŠ¶æ€å®Œæˆçš„ä»»åŠ¡å®Œå…¨ä¸ä¸€æ ·ã€‚
* ç­–ç•¥æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥è‡ªç”±é€‰æ‹©ä½¿ç”¨å“ªç§ç®—æ³•æˆ–è€…è¡Œä¸ºï¼›è€Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå…·ä½“ä½¿ç”¨å“ªç§çŠ¶æ€ï¼Œç”±ä¸Šä¸‹æ–‡ç¯å¢ƒæˆ–è€…å…·ä½“çŠ¶æ€ç±»æ¥æ§åˆ¶åˆ‡æ¢é€»è¾‘ã€‚

[.text-right]
ğŸ§ME: JDKä¸­æœ‰è¿™ä¸ªæ¨¡å¼çš„ä¾‹å­å—ï¼Ÿ

ğŸ™‚BING:
æˆ‘æ²¡æœ‰æ‰¾åˆ°æ˜æ˜¾ä½¿ç”¨è¿™ä¸ªæ¨¡å¼çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—Threadç±»å¯èƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç®€å•çš„å®ç°ã€‚Threadç±»æœ‰å‡ ç§ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼ˆNEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATEDï¼‰ï¼Œæ¯ç§çŠ¶æ€ä¸‹æ‰§è¡Œstart(), run(), join(), interrupt()ç­‰æ–¹æ³•å¯èƒ½ä¼šæœ‰ä¸åŒçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œåœ¨NEWçŠ¶æ€ä¸‹è°ƒç”¨start()æ–¹æ³•ä¼šå¯åŠ¨çº¿ç¨‹å¹¶è¿›å…¥RUNNABLEæˆ–è€…BLOCKEDç­‰å…¶ä»–å¯è¿è¡Œæ€ï¼›è€Œåœ¨TERMINATEDï¼ˆç»ˆæ­¢ï¼‰æ€ä¸‹è°ƒç”¨start()æ–¹æ³•ä¼šæŠ›å‡ºIllegalThreadStateExceptionå¼‚å¸¸ã€‚è¿™äº›é€»è¾‘å¯ä»¥çœ‹ä½œæ˜¯ç”±Threadç±»å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªStateæ¥å£å’Œå¤šä¸ªConcreteStateå®ç°ç±»æ¥å®Œæˆã€‚

FSMï¼ˆFinite State Machine, æœ‰é™çŠ¶æ€æœºï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ä½¿ç”¨äº†çŠ¶æ€æ¨¡å¼çš„å®ç°ï¼Œå®ƒæ˜¯ä¸€ç§æ•°å­¦æ¨¡å‹ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿåœ¨æœ‰é™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚å› ä¸ºå®ƒä¹Ÿæ˜¯é€šè¿‡å®šä¹‰ä¸€ç»„çŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢è§„åˆ™æ¥å®ç°æŸä¸ªåŠŸèƒ½ã€‚ä½†æ˜¯FSMä¸ä¸€å®šè¦ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼Œä¾‹å¦‚è¡¨æ ¼æˆ–è€…å›¾å½¢ã€‚è€ŒçŠ¶æ€æ¨¡å¼æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡å®šä¹‰ä¸€ä¸ªStateæ¥å£å’Œå¤šä¸ªConcreteStateå®ç°ç±»æ¥å°è£…ä¸åŒçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚

.ç±»å›¾
[source,text]
----
+-----------------+        +-----------------+
|     Context     |<>------|     State       |
+-----------------+        +-----------------+
| -state: State   |        | +doAction()     |
| +setState()     |        +-----------------+
| +getState()     |                 /_\
| +doAction()     |                  |
+-----------------+                  |
                                     |
                +--------------------+--------------------+
                |                                         |
                |                                         |
                v                                         v
        +-----------------+                     +-----------------+
        | ConcreteStateA  |                     | ConcreteStateB  |
        +-----------------+                     +-----------------+
        | +doAction()     |                     | +doAction()     |
        +-----------------+                     +-----------------+
----

Contextç±»æ˜¯ä¸€ä¸ªæŒæœ‰Stateæ¥å£çš„å¼•ç”¨çš„ç±»ï¼Œå®ƒè´Ÿè´£åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜è‡ªå·±çš„è¡Œä¸ºã€‚å®ƒæœ‰ä¸€ä¸ªstateå±æ€§ï¼Œè¡¨ç¤ºå½“å‰çš„çŠ¶æ€å¯¹è±¡ï¼Œä»¥åŠsetState(), getState()å’ŒdoAction()æ–¹æ³•ã€‚setState()æ–¹æ³•ç”¨äºè®¾ç½®å½“å‰çš„çŠ¶æ€å¯¹è±¡ï¼ŒgetState()æ–¹æ³•ç”¨äºè·å–å½“å‰çš„çŠ¶æ€å¯¹è±¡ï¼ŒdoAction()æ–¹æ³•ç”¨äºå§”æ‰˜å½“å‰çš„çŠ¶æ€å¯¹è±¡æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºã€‚
Stateæ¥å£æ˜¯ä¸€ä¸ªå®šä¹‰äº†ç»Ÿä¸€æ“ä½œæ¥å£çš„æŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªdoAction()æ–¹æ³•ï¼Œè¡¨ç¤ºåœ¨æŸä¸ªçŠ¶æ€ä¸‹è¦æ‰§è¡Œçš„è¡Œä¸ºã€‚ä¸åŒçš„å…·ä½“çŠ¶æ€ç±»å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå¹¶è¦†ç›–doAction()æ–¹æ³•ï¼Œä»¥å®ç°ä¸åŒçš„è¡Œä¸ºé€»è¾‘ã€‚
ConcreteStateAå’ŒConcreteStateBç±»æ˜¯Stateæ¥å£çš„ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸¤ç§å…·ä½“çš„çŠ¶æ€ã€‚å®ƒä»¬éƒ½å®ç°äº†doAction()æ–¹æ³•ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„çŠ¶æ€é€»è¾‘æ¥æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚
Contextç±»å’ŒStateæ¥å£ä¹‹é—´æœ‰ä¸€ä¸ªèšåˆå…³ç³»ï¼ˆ<>------ï¼‰ï¼Œè¡¨ç¤ºContextç±»æŒæœ‰ä¸€ä¸ªStateæ¥å£ç±»å‹çš„å±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§å¯ä»¥æŒ‡å‘ä¸åŒçš„å…·ä½“çŠ¶æ€å¯¹è±¡ã€‚Contextç±»å¯ä»¥é€šè¿‡setState()æ–¹æ³•æ¥æ”¹å˜è¿™ä¸ªå±æ€§çš„æŒ‡å‘ï¼Œå¹¶ä¸”é€šè¿‡getState()æ–¹æ³•æ¥è·å–è¿™ä¸ªå±æ€§çš„å€¼ã€‚
Stateæ¥å£å’ŒConcreteStateAå’ŒConcreteStateBç±»ä¹‹é—´æœ‰ä¸€ä¸ªæ³›åŒ–å…³ç³»ï¼ˆ/_\ï¼‰ï¼Œè¡¨ç¤ºConcreteStateAå’ŒConcreteStateBç±»éƒ½æ˜¯Stateæ¥å£ç±»å‹çš„å­ç±»ï¼Œå¹¶ä¸”ç»§æ‰¿äº†å®ƒçš„doAction()æ–¹æ³•ã€‚å®ƒä»¬å¯ä»¥è¦†ç›–è¿™ä¸ªæ–¹æ³•æ¥å®ç°è‡ªå·±ç‰¹æœ‰çš„è¡Œä¸ºé€»è¾‘ã€‚

.ç¤ºä¾‹ä»£ç 
[source,java]
----
// å®šä¹‰Stateæ¥å£
public interface State {
    // å®šä¹‰doAction()æ–¹æ³•
    void doAction(Context context);
}

// å®šä¹‰ConcreteStateAç±»ï¼Œå®ç°Stateæ¥å£
public class ConcreteStateA implements State {
    // è¦†ç›–doAction()æ–¹æ³•
    @Override
    public void doAction(Context context) {
        // åœ¨çŠ¶æ€Aä¸‹è¦æ‰§è¡Œçš„æ“ä½œ
        System.out.println("This is state A.");
        // è®¾ç½®contextçš„çŠ¶æ€ä¸ºå½“å‰çŠ¶æ€å¯¹è±¡
        context.setState(this);
    }
}

// å®šä¹‰ConcreteStateBç±»ï¼Œå®ç°Stateæ¥å£
public class ConcreteStateB implements State {
    // è¦†ç›–doAction()æ–¹æ³•
    @Override
    public void doAction(Context context) {
        // åœ¨çŠ¶æ€Bä¸‹è¦æ‰§è¡Œçš„æ“ä½œ
        System.out.println("This is state B.");
        // è®¾ç½®contextçš„çŠ¶æ€ä¸ºå½“å‰çŠ¶æ€å¯¹è±¡
        context.setState(this);
    }
}

// å®šä¹‰Contextç±»ï¼ŒæŒæœ‰Stateæ¥å£çš„å¼•ç”¨
public class Context {
    // å®šä¹‰ä¸€ä¸ªstateå±æ€§ï¼Œè¡¨ç¤ºå½“å‰çš„çŠ¶æ€å¯¹è±¡
    private State state;

    // å®šä¹‰ä¸€ä¸ªsetState()æ–¹æ³•ï¼Œç”¨äºè®¾ç½®å½“å‰çš„çŠ¶æ€å¯¹è±¡
    public void setState(State state) {
        this.state = state;
    }

    // å®šä¹‰ä¸€ä¸ªgetState()æ–¹æ³•ï¼Œç”¨äºè·å–å½“å‰çš„çŠ¶æ€å¯¹è±¡
    public State getState() {
        return state;
    }

    // å®šä¹‰ä¸€ä¸ªdoAction()æ–¹æ³•ï¼Œç”¨äºå§”æ‰˜å½“å‰çš„çŠ¶æ€å¯¹è±¡æ‰§è¡Œç›¸åº”çš„è¡Œä¸º
    public void doAction() {
        state.doAction(this);
    }
}

// æµ‹è¯•ç±»
public class Test {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªContextå¯¹è±¡
        Context context = new Context();

        // åˆ›å»ºä¸¤ä¸ªå…·ä½“çš„çŠ¶æ€å¯¹è±¡
        State stateA = new ConcreteStateA();
        State stateB = new ConcreteStateB();

        // è®¾ç½®contextçš„çŠ¶æ€ä¸ºstateAï¼Œå¹¶æ‰§è¡ŒdoAction()æ–¹æ³•
        context.setState(stateA);
        context.doAction(); // è¾“å‡ºï¼šThis is state A.

        // è®¾ç½®contextçš„çŠ¶æ€ä¸ºstateBï¼Œå¹¶æ‰§è¡ŒdoAction()æ–¹æ³•
        context.setState(stateB);
        context.doAction(); // è¾“å‡ºï¼šThis is state B.

    }
}
----
[.text-right]
ğŸ§ME: ä¸ºä»€ä¹ˆè¦åœ¨ ConcreteStateA ä¸­ doAction() çš„æ—¶å€™æ‰§è¡Œ context.setState(this)ï¼Œéš¾é“ä¸åº”è¯¥å˜ä¸ºå…¶å®ƒçŠ¶æ€å—ï¼Ÿ

ğŸ™‚BING:
è¿™ä¸ªä»£ç åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¸ºäº†æ¼”ç¤ºçŠ¶æ€æ¨¡å¼çš„åŸºæœ¬ç»“æ„å’Œé€»è¾‘ã€‚åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œå…·ä½“çš„çŠ¶æ€ç±»å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ¥åˆ‡æ¢åˆ°å…¶ä»–çš„çŠ¶æ€ï¼Œè€Œä¸ä¸€å®šè¦è®¾ç½®ä¸ºè‡ªå·±ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçŠ¶æ€Cï¼Œè¡¨ç¤ºåœ¨çŠ¶æ€Aå’ŒçŠ¶æ€Bä¹‹é—´åˆ‡æ¢çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ ConcreteStateA ç±»å¯ä»¥åœ¨ doAction() æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ»¡è¶³çŠ¶æ€Cçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³å°±è®¾ç½® context çš„çŠ¶æ€ä¸ºçŠ¶æ€Cï¼Œå¦åˆ™ä¿æŒä¸ºçŠ¶æ€Aã€‚è¿™æ ·å°±å¯ä»¥å®ç°æ›´å¤æ‚çš„çŠ¶æ€è½¬æ¢é€»è¾‘ã€‚

=== Strategy ç­–ç•¥æ¨¡å¼
[quote]
ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬å°è£…åœ¨ä¸åŒçš„ç±»ä¸­ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯æˆ–éœ€æ±‚é€‰æ‹©ä¸åŒçš„ç®—æ³•ï¼Œé¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

.ä¼˜ç‚¹
* ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚
* é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚
* æ‰©å±•æ€§è‰¯å¥½ã€‚
* å®ç°äº†ç®—æ³•å’Œä½¿ç”¨è€…çš„è§£è€¦ã€‚

.ç¼ºç‚¹
* ç­–ç•¥ç±»ä¼šå¢å¤šã€‚
* æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚
* å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚

.é€‚ç”¨åœºæ™¯
* ä¸€ä¸ªç³»ç»Ÿæœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºã€‚
* ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚
* å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚

ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å°è£…ä¸åŒçš„è¡Œä¸ºæ¥å®ç°åŠ¨æ€åˆ‡æ¢ã€‚ä½†æ˜¯çŠ¶æ€æ¨¡å¼æ˜¯æ ¹æ®å¯¹è±¡å†…éƒ¨çŠ¶æ€æ¥æ”¹å˜è¡Œä¸ºï¼Œè€Œç­–ç•¥æ¨¡å¼æ˜¯æ ¹æ®å¤–éƒ¨ç¯å¢ƒæ¥æ”¹å˜è¡Œä¸ºã€‚çŠ¶æ€æ¨¡å¼é€šå¸¸ç”±çŠ¶æ€å¯¹è±¡è‡ªå·±æ§åˆ¶çŠ¶æ€è½¬æ¢ï¼Œè€Œç­–ç•¥æ¨¡å¼ç”±å®¢æˆ·ç«¯æˆ–ç¯å¢ƒç±»æ§åˆ¶ç­–ç•¥é€‰æ‹©ã€‚

.jdkä¸­çš„åº“ï¼Œä»¥åŠä¸€äº›ä¾‹å­
JDKä¸­æœ‰å¾ˆå¤šä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„ä¾‹å­ï¼Œæ¯”å¦‚java.util.Comparatoræ¥å£å°±æ˜¯ä¸€ä¸ªç­–ç•¥æ¥å£ï¼Œå®ƒå®šä¹‰äº†æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚ä¸åŒçš„å®ç°ç±»å¯ä»¥æä¾›ä¸åŒçš„æ¯”è¾ƒç®—æ³•ï¼Œä¾‹å¦‚æŒ‰ç…§å§“åæ’åºã€æŒ‰ç…§å¹´é¾„æ’åºç­‰ã€‚å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„æ¯”è¾ƒå™¨æ¥å¯¹é›†åˆè¿›è¡Œæ’åºã€‚

.ç±»å›¾
[source,text]
----
+-----------------+       +-----------------+
|    Context      |       |    Strategy     |
+-----------------+<|-----+-----------------+
| -strategy       |       | +doOperation()  |
| +executeStrategy|       +-----------------+
+-----------------+              /|\
                                  |
                  +---------------+---------------+
                  |                               |
                  |                               |
          +-----------------+             +------------------+
          | OperationAdd    |             | OperationSubtract|
          +-----------------+             +------------------+
          | +doOperation()  |             | +doOperation()   |
          +-----------------+             +------------------+
----
è¿™ä¸ªç±»å›¾è¡¨ç¤ºäº†ç­–ç•¥æ¨¡å¼çš„åŸºæœ¬ç»“æ„ï¼Œå…¶ä¸­Strategyæ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œå®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„è¡Œä¸ºã€‚Contextæ˜¯ä¸€ä¸ªç¯å¢ƒç±»ï¼ŒæŒæœ‰ä¸€ä¸ªStrategyçš„å¼•ç”¨ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç­–ç•¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚OperationAddå’ŒOperationSubtractæ˜¯ä¸¤ä¸ªå…·ä½“çš„ç­–ç•¥ç±»ï¼Œå®ç°äº†Strategyæ¥å£ï¼Œå¹¶æä¾›äº†ä¸åŒçš„ç®—æ³•å®ç°ã€‚

.ç¤ºä¾‹ä»£ç 
[source,java]
----
//å®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£
public interface Strategy {
    //æ‰§è¡ŒæŸç§ç®—æ³•çš„æ–¹æ³•
    public void execute();
}

//å®šä¹‰ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»ï¼Œå®ç°äº†ç­–ç•¥æ¥å£
public class ConcreteStrategyA implements Strategy {
    @Override
    public void execute() {
        //å…·ä½“çš„ç®—æ³•é€»è¾‘
        System.out.println("æ‰§è¡Œç­–ç•¥A");
    }
}

//å®šä¹‰å¦ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»ï¼Œå®ç°äº†ç­–ç•¥æ¥å£
public class ConcreteStrategyB implements Strategy {
    @Override
    public void execute() {
        //å…·ä½“çš„ç®—æ³•é€»è¾‘
        System.out.println("æ‰§è¡Œç­–ç•¥B");
    }
}

//å®šä¹‰ä¸€ä¸ªç¯å¢ƒç±»ï¼ŒæŒæœ‰ä¸€ä¸ªç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç­–ç•¥æ‰§è¡Œä¸åŒçš„æ“ä½œ
public class Context {
    //ç­–ç•¥å¯¹è±¡çš„å¼•ç”¨
    private Strategy strategy;

    //æ„é€ æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡
    public Context(Strategy strategy) {
        this.strategy = strategy;
    }

    //æ‰§è¡Œç­–ç•¥å¯¹è±¡çš„æ–¹æ³•
    public void executeStrategy() {
        strategy.execute();
    }
}

//æµ‹è¯•ç±»ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ç¯å¢ƒç±»å’Œç­–ç•¥å¯¹è±¡æ¥å®Œæˆä¸åŒçš„è¡Œä¸º
public class Test {
    public static void main(String[] args) {
        //åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡A
        Strategy strategyA = new ConcreteStrategyA();
        //åˆ›å»ºä¸€ä¸ªç¯å¢ƒå¯¹è±¡ï¼Œå¹¶ä¼ å…¥ç­–ç•¥å¯¹è±¡A
        Context context = new Context(strategyA);
        //æ‰§è¡Œç¯å¢ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œè°ƒç”¨ç­–ç•¥å¯¹è±¡Açš„æ–¹æ³•
        context.executeStrategy();

        //åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡B
        Strategy strategyB = new ConcreteStrategyB();
        //æ”¹å˜ç¯å¢ƒå¯¹è±¡çš„ç­–ç•¥å¯¹è±¡ä¸ºB
        context = new Context(strategyB);
        //æ‰§è¡Œç¯å¢ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œè°ƒç”¨ç­–ç•¥å¯¹è±¡Bçš„æ–¹æ³•
        context.executeStrategy();
    }
}
----
è¿™ä¸ªç¤ºä¾‹ä»£ç è¡¨ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°ä¸åŒçš„ç®—æ³•ã€‚å…¶ä¸­Strategyæ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œå®šä¹‰äº†ä¸€ä¸ªexecute()æ–¹æ³•ã€‚ConcreteStrategyAå’ŒConcreteStrategyBæ˜¯ä¸¤ä¸ªå…·ä½“çš„ç­–ç•¥ç±»ï¼Œå®ç°äº†Strategyæ¥å£ï¼Œå¹¶æä¾›äº†ä¸åŒçš„ç®—æ³•å®ç°ã€‚Contextæ˜¯ä¸€ä¸ªç¯å¢ƒç±»ï¼ŒæŒæœ‰ä¸€ä¸ªStrategyçš„å¼•ç”¨ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç­–ç•¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚Testæ˜¯ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨Contextå’ŒStrategyå¯¹è±¡æ¥å®Œæˆä¸åŒçš„è¡Œä¸ºã€‚

=== Chain of Responsibility è´£ä»»é“¾æ¨¡å¼
[quote]
è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚è´£ä»»é“¾æ¨¡å¼æŠŠå¤šä¸ªå¤„ç†å™¨ï¼ˆä¹Ÿç§°ä¸ºå¤„ç†èŠ‚ç‚¹ï¼‰ä¸²æˆä¸€æ¡é“¾ï¼Œç„¶åè®©è¯·æ±‚åœ¨é“¾ä¸Šä¾æ¬¡ä¼ é€’ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¤„ç†å™¨èƒ½å¤Ÿå¤„ç†å®ƒä¸ºæ­¢ã€‚

.ä¼˜ç‚¹
* é™ä½è€¦åˆåº¦ã€‚å®ƒå°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ã€‚
* ç®€åŒ–äº†å¯¹è±¡ã€‚ä½¿å¾—å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ã€‚
* å¢å¼ºç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚é€šè¿‡æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œå…è®¸åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚
* å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»å¾ˆæ–¹ä¾¿ã€‚

.ç¼ºç‚¹
* ä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šè¢«æ¥æ”¶ã€‚
* ç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œè€Œä¸”åœ¨è¿›è¡Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚
* å¯èƒ½ä¸å®¹æ˜“è§‚å¯Ÿè¿è¡Œæ—¶çš„ç‰¹å¾ï¼Œæœ‰ç¢äºé™¤é”™ã€‚

.é€‚ç”¨åœºæ™¯
* æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚
* åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚
* å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ã€‚

è´£ä»»é“¾æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯å°†è¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™ä¸€ä¸ªå¤„ç†å™¨ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‘½ä»¤æ¨¡å¼åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼Œè€Œè´£ä»»é“¾æ¨¡å¼æœ‰å¤šä¸ªæ¥æ”¶è€…ï¼Œå¹¶ä¸”æ¯ä¸ªæ¥æ”¶è€…éƒ½å¯ä»¥å†³å®šæ˜¯å¦ç»§ç»­ä¼ é€’è¯·æ±‚æˆ–è€…ç›´æ¥å¤„ç†è¯·æ±‚ã€‚å‘½ä»¤æ¨¡å¼æ›´å¼ºè°ƒå¯¹è¯·æ±‚çš„å°è£…å’Œè§£è€¦ï¼Œè€Œè´£ä»»é“¾æ¨¡å¼æ›´å¼ºè°ƒå¯¹è¯·æ±‚çš„åˆ†å‘å’Œçµæ´»æ€§ã€‚

.jdkä¸­çš„åº“ï¼Œä»¥åŠä¸€äº›ä¾‹å­
JDKä¸­æœ‰ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼çš„ä¾‹å­ï¼Œä¾‹å¦‚java.util.logging.Loggerç±»ã€‚Loggerç±»å¯ä»¥è®¾ç½®çˆ¶Loggerï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®æ˜¯å¦ä½¿ç”¨çˆ¶Loggerçš„Handleræ¥å¤„ç†æ—¥å¿—æ¶ˆæ¯ã€‚å½“ä¸€ä¸ªLoggeræ¥æ”¶åˆ°ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ ¹æ®è‡ªå·±çš„çº§åˆ«å’Œè¿‡æ»¤å™¨æ¥åˆ¤æ–­æ˜¯å¦è®°å½•è¯¥æ¶ˆæ¯ï¼Œç„¶åæ ¹æ®æ˜¯å¦ä½¿ç”¨çˆ¶Loggerçš„Handleræ¥å†³å®šæ˜¯å¦å°†è¯¥æ¶ˆæ¯ä¼ é€’ç»™çˆ¶Loggerã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨çš„è´£ä»»é“¾ã€‚

.ç±»å›¾
[source,text]
----
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Handler      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚+next:Handler  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚+handleRequest()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–³
          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚
                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ConcreteHandler â”‚     â”‚ConcreteHandler â”‚     â”‚ConcreteHandler â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                â”‚     â”‚                â”‚     â”‚                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚+handleRequest()â”‚â—€â”€â”€â”€â–¶â”‚+handleRequest()â”‚â—€â”€â”€â”€â–¶â”‚+handleRequest()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
----
Handlerï¼šæŠ½è±¡å¤„ç†å™¨ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ã€‚
ConcreteHandlerï¼šå…·ä½“å¤„ç†å™¨ï¼Œå®ç°äº†Handleræ¥å£ï¼Œæ ¹æ®è‡ªå·±çš„é€»è¾‘æ¥åˆ¤æ–­æ˜¯å¦å¤„ç†è¯·æ±‚æˆ–è€…ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚


.ç¤ºä¾‹ä»£ç 
[source,java]
----
// å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„æ—¥å¿—å¤„ç†å™¨æ¥å£
public interface LogHandler {
    // å®šä¹‰æ—¥å¿—çº§åˆ«çš„å¸¸é‡
    int DEBUG = 1;
    int INFO = 2;
    int ERROR = 3;

    // å¤„ç†æ—¥å¿—çš„æ–¹æ³•ï¼Œå‚æ•°ä¸ºæ—¥å¿—å¯¹è±¡
    void handleLog(Log log);

    // è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„æ–¹æ³•ï¼Œå‚æ•°ä¸ºæ—¥å¿—å¤„ç†å™¨å¯¹è±¡
    void setNextHandler(LogHandler nextHandler);
}

// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„æ—¥å¿—å¤„ç†å™¨ç±»ï¼Œç”¨æ¥å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°
public class ConsoleLogHandler implements LogHandler {
    // å®šä¹‰å½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„æ—¥å¿—çº§åˆ«
    private int level = DEBUG;

    // å®šä¹‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨
    private LogHandler nextHandler;

    @Override
    public void handleLog(Log log) {
        // å¦‚æœå½“å‰æ—¥å¿—çš„çº§åˆ«å°äºç­‰äºå½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„çº§åˆ«ï¼Œå°±å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°
        if (log.getLevel() <= level) {
            System.out.println("ConsoleLogHandler: " + log.getMessage());
        }
        // å¦‚æœå½“å‰å¤„ç†å™¨æœ‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼Œå°±å°†æ—¥å¿—ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
        if (nextHandler != null) {
            nextHandler.handleLog(log);
        }
    }

    @Override
    public void setNextHandler(LogHandler nextHandler) {
        this.nextHandler = nextHandler;
    }
}

// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„æ—¥å¿—å¤„ç†å™¨ç±»ï¼Œç”¨æ¥å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶
public class FileLogHandler implements LogHandler {
    // å®šä¹‰å½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„æ—¥å¿—çº§åˆ«
    private int level = INFO;

    // å®šä¹‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨
    private LogHandler nextHandler;

    @Override
    public void handleLog(Log log) {
        // å¦‚æœå½“å‰æ—¥å¿—çš„çº§åˆ«å°äºç­‰äºå½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„çº§åˆ«ï¼Œå°±å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶
        if (log.getLevel() <= level) {
            System.out.println("FileLogHandler: " + log.getMessage());
            // è¿™é‡Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶æ“ä½œç±»æ¥å®é™…å†™å…¥æ–‡ä»¶ï¼Œè¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œçœç•¥äº†æ–‡ä»¶æ“ä½œçš„ç»†èŠ‚
        }
        // å¦‚æœå½“å‰å¤„ç†å™¨æœ‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼Œå°±å°†æ—¥å¿—ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
        if (nextHandler != null) {
            nextHandler.handleLog(log);
        }
    }

    @Override
    public void setNextHandler(LogHandler nextHandler) {
        this.nextHandler = nextHandler;
    }
}

// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„æ—¥å¿—å¤„ç†å™¨ç±»ï¼Œç”¨æ¥å°†æ—¥å¿—è¾“å‡ºåˆ°æ•°æ®åº“
public class DatabaseLogHandler implements LogHandler {
    // å®šä¹‰å½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„æ—¥å¿—çº§åˆ«
    private int level = ERROR;

    // å®šä¹‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨
    private LogHandler nextHandler;

    @Override
    public void handleLog(Log log) {
        // å¦‚æœå½“å‰æ—¥å¿—çš„çº§åˆ«å°äºç­‰äºå½“å‰å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†çš„çº§åˆ«ï¼Œå°±å°†æ—¥å¿—è¾“å‡ºåˆ°æ•°æ®åº“
        if (log.getLevel() <= level) {
            System.out.println("DatabaseLogHandler: " + log.getMessage());
            // è¿™é‡Œå¯ä»¥ä½¿ç”¨æ•°æ®åº“æ“ä½œç±»æ¥å®é™…å†™å…¥æ•°æ®åº“ï¼Œè¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œçœç•¥äº†æ•°æ®åº“æ“ä½œçš„ç»†èŠ‚
        }
        // å¦‚æœå½“å‰å¤„ç†å™¨æœ‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼Œå°±å°†æ—¥å¿—ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
        if (nextHandler != null) {
            nextHandler.handleLog(log);
        }
    }

    @Override
    public void setNextHandler(LogHandler nextHandler) {
        this.nextHandler = nextHandler;
    }
}

// å®šä¹‰ä¸€ä¸ªæ—¥å¿—ç±»ï¼Œç”¨æ¥å°è£…æ—¥å¿—çš„ä¿¡æ¯
public class Log {
    // å®šä¹‰æ—¥å¿—çš„çº§åˆ«å’Œæ¶ˆæ¯å±æ€§
    private int level;
    private String message;

    // æ„é€ æ–¹æ³•ï¼Œä¼ å…¥çº§åˆ«å’Œæ¶ˆæ¯å‚æ•°
    public Log(int level, String message) {
         this.level = level;
         this.message = message;
     }

     // è·å–å’Œè®¾ç½®çº§åˆ«å’Œæ¶ˆæ¯çš„æ–¹æ³•
     public int getLevel() {
         return level;
     }

     public void setLevel(int level) {
         this.level = level;
     }

     public String getMessage() {
         return message;
     }

     public void setMessage(String message) {
         this.message = message;
     }
}

// å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªè´£ä»»é“¾ï¼Œå¹¶å‘å…¶ä¸­å‘é€ä¸åŒçº§åˆ«çš„æ—¥å¿—
public class Test {
    public static void main(String[] args) {
        // åˆ›å»ºä¸‰ä¸ªå…·ä½“çš„æ—¥å¿—å¤„ç†å™¨å¯¹è±¡
        LogHandler consoleLogHandler = new ConsoleLogHandler();
        LogHandler fileLogHandler = new FileLogHandler();
        LogHandler databaseLogHandler = new DatabaseLogHandler();

        // å°†æ—¥å¿—å¤„ç†å™¨å¯¹è±¡è¿æ¥æˆä¸€ä¸ªè´£ä»»é“¾ï¼Œæ§åˆ¶å°->æ–‡ä»¶->æ•°æ®åº“
        consoleLogHandler.setNextHandler(fileLogHandler);
        fileLogHandler.setNextHandler(databaseLogHandler);

        // åˆ›å»ºä¸‰ä¸ªä¸åŒçº§åˆ«çš„æ—¥å¿—å¯¹è±¡
        Log debugLog = new Log(LogHandler.DEBUG, "This is a debug log.");
        Log infoLog = new Log(LogHandler.INFO, "This is an info log.");
        Log errorLog = new Log(LogHandler.ERROR, "This is an error log.");

        // å‘è´£ä»»é“¾å‘é€æ—¥å¿—å¯¹è±¡
        consoleLogHandler.handleLog(debugLog);
        consoleLogHandler.handleLog(infoLog);
        consoleLogHandler.handleLog(errorLog);
    }
}
----
=== Mediator ä¸­ä»‹è€…æ¨¡å¼
[quote]
ä¸­ä»‹è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿å¾—å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œé™ä½äº†è€¦åˆåº¦ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚

.ä¼˜ç‚¹
* é™ä½äº†ç±»çš„å¤æ‚åº¦ï¼Œå°†ä¸€å¯¹å¤šè½¬åŒ–æˆäº†ä¸€å¯¹ä¸€ã€‚
* å„ä¸ªç±»ä¹‹é—´çš„è§£è€¦ã€‚
* ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ã€‚

.ç¼ºç‚¹
* ä¸­ä»‹è€…ä¼šåºå¤§ï¼Œå˜å¾—å¤æ‚éš¾ä»¥ç»´æŠ¤ã€‚
* ä¸­ä»‹è€…è¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚ã€‚

.é€‚ç”¨åœºæ™¯
* ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œå¯¼è‡´å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ç»“æ„æ··ä¹±ä¸”éš¾ä»¥ç†è§£ã€‚
* äº¤äº’çš„å…¬å…±è¡Œä¸ºï¼Œå¦‚æœéœ€è¦æ”¹å˜è¡Œä¸ºåˆ™å¯ä»¥å¢åŠ æ–°çš„ä¸­ä»‹è€…ç±»ã€‚

ä¸­ä»‹è€…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡æ¥ç®¡ç†å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„äº¤äº’ã€‚ä½†æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè€Œä¸­ä»‹è€…æ¨¡å¼æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ï¼Œè€Œä¸­ä»‹è€…æ¨¡å¼ä¸­ï¼ŒåŒäº‹ç±»å’Œä¸­ä»‹è€…ä¹‹é—´æ˜¯ç´§è€¦åˆçš„ã€‚

.jdkä¸­çš„åº“ï¼Œä»¥åŠä¸€äº›ä¾‹å­
JDKä¸­æœ‰ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„ä¾‹å­ï¼Œæ¯”å¦‚java.util.Timerç±»ã€‚Timerç±»å……å½“äº†ä¸­ä»‹è€…çš„è§’è‰²ï¼Œå®ƒç®¡ç†äº†å¤šä¸ªTimerTaskå¯¹è±¡ä¹‹é—´çš„è°ƒåº¦å’Œæ‰§è¡Œã€‚TimerTaskå¯¹è±¡åªéœ€è¦æ³¨å†Œåˆ°Timerç±»ä¸­ï¼Œå°±å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œä»»åŠ¡ã€‚


.ç±»å›¾
[source,text]
----
+-----------------------+        +-------------------------+
|   Mediator            |<-------|   Colleague             |
+-----------------------+        +-------------------------+
|                       |        | -mediator:Mediator      |
+-----------------------+        +-------------------------+
| +register(c:Colleague)|        | +Colleague(m:Mediator)  |
| +relay(c:Colleague)   |        | +setMediator(m:Mediator)|
+-----------------------+        | +receive()              |
          / \                    | +send()                 |
           |                     +-------------------------+
           |                                  / \
           |                                   |
           |                                   |
           |                                   |
           |                                   |
           |                                   |
+-----------------------------+       +-------------------+
| ConcreteMediator            |       | ConcreteColleague |
+-----------------------------+       +-------------------+
| -colleagues:List<Colleague> |       |                   |
+-----------------------------+       +-------------------+
| #register(c:Colleague)      |       | #receive()        |
| #relay(c:Colleague)         |       | #send()           |
+-----------------------------+       +-------------------+
----
å…¶ä¸­ï¼ŒMediatoræ˜¯æŠ½è±¡ä¸­ä»‹è€…ç±»ï¼Œå®šä¹‰äº†åŒäº‹å¯¹è±¡ä¹‹é—´çš„é€šä¿¡æ¥å£ï¼›ConcreteMediatoræ˜¯å…·ä½“ä¸­ä»‹è€…ç±»ï¼Œå®ç°äº†æŠ½è±¡ä¸­ä»‹è€…çš„æ–¹æ³•ï¼Œå¹¶ç»´æŠ¤äº†ä¸€ä¸ªåŒäº‹å¯¹è±¡çš„é›†åˆï¼›Colleagueæ˜¯æŠ½è±¡åŒäº‹ç±»ï¼Œå®šä¹‰äº†åŒäº‹å¯¹è±¡çš„å…¬å…±æ–¹æ³•ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡çš„å¼•ç”¨ï¼›ConcreteColleagueæ˜¯å…·ä½“åŒäº‹ç±»ï¼Œå®ç°äº†æŠ½è±¡åŒäº‹ç±»çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¸­ä»‹è€…å¯¹è±¡ä¸å…¶ä»–åŒäº‹å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚


.ç±»å›¾
[source,text]
----
+-----------------+           +-----------------+
|    ChatRoom     |<---uses---|   User          |
+-----------------+           +-----------------+
| +register(user) |           | -name           |
| +relay(user,msg)|           | -chatRoom       |
+-----------------+           | +send(msg)      |
        ^                     | +receive(msg)   |
        |                     +-----------------+
        |                          ^
        |                          |
        |                          |
        |                 +-----------------+
        +---------------->|  ConcreteUser   |
                          +-----------------+
                          | +send(msg)      |
                          | +receive(msg)   |
                          +-----------------+

----

.ç¤ºä¾‹ä»£ç 
[source,java]
----
// å‡è®¾æœ‰ä¸€ä¸ªèŠå¤©å®¤çš„åº”ç”¨ï¼Œæœ‰å¤šä¸ªç”¨æˆ·å¯ä»¥å‘èŠå¤©å®¤å‘é€æ¶ˆæ¯ï¼ŒèŠå¤©å®¤å‘æ‰€æœ‰çš„ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½
// ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰äº†æ³¨å†ŒåŒäº‹å’Œè½¬å‘æ¶ˆæ¯çš„æ–¹æ³•
public interface ChatRoom {
    void register(User user);
    void relay(User user, String message);
}

// å…·ä½“çš„ä¸­ä»‹è€…ç±»ï¼Œå®ç°äº†ä¸­ä»‹è€…æ¥å£ï¼Œç»´æŠ¤äº†ä¸€ä¸ªåŒäº‹åˆ—è¡¨ï¼Œè´Ÿè´£è½¬å‘æ¶ˆæ¯ç»™å…¶ä»–åŒäº‹
public class ConcreteChatRoom implements ChatRoom {
    private List<User> users;

    public ConcreteChatRoom() {
        users = new ArrayList<>();
    }

    @Override
    public void register(User user) {
        if (!users.contains(user)) {
            users.add(user);
            user.setChatRoom(this);
        }
    }

    @Override
    public void relay(User user, String message) {
        for (User u : users) {
            if (!u.equals(user)) {
                u.receive(message);
            }
        }
    }
}

// åŒäº‹æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ–¹æ³•ï¼ŒæŒæœ‰ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡çš„å¼•ç”¨
public abstract class User {
    protected String name;
    protected ChatRoom chatRoom;

    public User(String name) {
        this.name = name;
    }

    public void setChatRoom(ChatRoom chatRoom) {
        this.chatRoom = chatRoom;
    }

    public abstract void send(String message);

    public abstract void receive(String message);
}

// å…·ä½“çš„åŒäº‹ç±»ï¼Œå®ç°äº†åŒäº‹æŠ½è±¡ç±»ï¼Œè°ƒç”¨ä¸­ä»‹è€…å¯¹è±¡çš„æ–¹æ³•æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
public class ConcreteUser extends User {

    public ConcreteUser(String name) {
        super(name);
    }

    @Override
    public void send(String message) {
        System.out.println(name + "å‘é€æ¶ˆæ¯ï¼š" + message);
        chatRoom.relay(this, message);
    }

    @Override
    public void receive(String message) {
        System.out.println(name + "æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
    }
}

// æµ‹è¯•ç±»ï¼Œåˆ›å»ºä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡å’Œå‡ ä¸ªåŒäº‹å¯¹è±¡ï¼Œå¹¶è®©ä»–ä»¬äº’ç›¸å‘é€æ¶ˆæ¯
public class Test {

    public static void main(String[] args) {
        ChatRoom chatRoom = new ConcreteChatRoom();
        User alice = new ConcreteUser("Alice");
        User bob = new ConcreteUser("Bob");
        User cathy = new ConcreteUser("Cathy");
        chatRoom.register(alice);
        chatRoom.register(bob);
        chatRoom.register(cathy);

        alice.send("Hello everyone!");
        bob.send("Hi Alice!");
        cathy.send("Hi Bob!");
    }
}
----
ä»¥ä¸Šä»£ç ä½¿ç”¨äº†ä¸­ä»‹è€…æ¨¡å¼ã€‚å®ƒå®ç°äº†ä¸€ä¸ªèŠå¤©å®¤åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å¤šä¸ªç”¨æˆ·å¯ä»¥å‘èŠå¤©å®¤å‘é€æ¶ˆæ¯ï¼ŒèŠå¤©å®¤å‘æ‰€æœ‰çš„ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚å…¶ä¸­ï¼Œä¸­ä»‹è€…æ¥å£ ChatRoom å®šä¹‰äº†æ³¨å†ŒåŒäº‹å’Œè½¬å‘æ¶ˆæ¯çš„æ–¹æ³•ï¼Œå…·ä½“çš„ä¸­ä»‹è€…ç±» ConcreteChatRoom å®ç°äº†ä¸­ä»‹è€…æ¥å£ï¼Œå¹¶ç»´æŠ¤äº†ä¸€ä¸ªåŒäº‹åˆ—è¡¨ï¼Œè´Ÿè´£è½¬å‘æ¶ˆæ¯ç»™å…¶ä»–åŒäº‹ã€‚åŒäº‹æŠ½è±¡ç±» User å®šä¹‰äº†å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ–¹æ³•ï¼ŒæŒæœ‰ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡çš„å¼•ç”¨ protected ChatRoom chatRoomï¼Œå…·ä½“çš„åŒäº‹ç±» ConcreteUser å®ç°äº†åŒäº‹æŠ½è±¡ç±»ï¼Œè°ƒç”¨ä¸­ä»‹è€…å¯¹è±¡çš„æ–¹æ³• chatRoom.relay æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚æµ‹è¯•ç±»åˆ›å»ºäº†ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡å’Œå‡ ä¸ªåŒäº‹å¯¹è±¡ï¼Œå¹¶è®©ä»–ä»¬äº’ç›¸å‘é€æ¶ˆæ¯ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡åè°ƒæ¶ˆæ¯ä¼ é€’ã€‚è¿™ä¸ªè®¾è®¡æ»¡è¶³äº†ä¸­ä»‹è€…æ¨¡å¼çš„å®šä¹‰ï¼Œ`é€šè¿‡ä¸­ä»‹è€…å¯¹è±¡æ¥è§£è€¦äº†åŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿å¾—å®ƒä»¬ä¹‹é—´ä¸å†éœ€è¦ç›¸äº’äº†è§£å’Œç›´æ¥äº¤äº’`ã€‚

=== Interpreter è§£é‡Šå™¨æ¨¡å¼
[quote]
è§£é‡Šå™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨æ¥è§£é‡Šä¸€ç§è¯­è¨€çš„è¯­æ³•æˆ–è¡¨è¾¾å¼ã€‚

.è§£é‡Šå™¨æ¨¡å¼çš„ä¸»è¦è§’è‰²æœ‰å››ä¸ª
1. æŠ½è±¡è¡¨è¾¾å¼ï¼ˆAbstract Expressionï¼‰ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³• interpret()ã€‚
2. ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆTerminal Expressionï¼‰ï¼šæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½æœ‰ä¸€ä¸ªå…·ä½“ç»ˆç»“è¡¨è¾¾å¼ä¸ä¹‹ç›¸å¯¹åº”ã€‚
3. éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆNonterminal Expressionï¼‰ï¼šä¹Ÿæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚
4. ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåé¢çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚

.ä¼˜ç‚¹
æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿æœºåˆ¶å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼ã€‚

.ç¼ºç‚¹
æ•ˆç‡ä½ï¼Œè°ƒç”¨éº»çƒ¦ï¼Œå®¹æ˜“å¼•èµ·ç±»è†¨èƒ€ï¼Œè€Œä¸”å¯¹äºå¤æ‚çš„æ–‡æ³•éš¾ä»¥ç»´æŠ¤ã€‚

.é€‚ç”¨åœºæ™¯
* å¯ä»¥å°†ä¸€ä¸ªéœ€è¦è§£é‡Šæ‰§è¡Œçš„è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚
* ä¸€äº›é‡å¤å‡ºç°çš„é—®é¢˜å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾ã€‚
* ä¸€ä¸ªç®€å•è¯­æ³•éœ€è¦è§£é‡Šçš„åœºæ™¯ã€‚

è§£é‡Šå™¨æ¨¡å¼å’Œå…¶ä»–è®¾è®¡æ¨¡å¼æ¯”è¾ƒç±»ä¼¼çš„æœ‰ï¼š

* å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰ï¼šä¹Ÿæ˜¯å°†ä¸€ä¸ªé—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªå¯¹è±¡æ¥è¡¨ç¤ºå’Œå¤„ç†ï¼Œä½†å‘½ä»¤æ¨¡å¼æ›´ä¾§é‡äºå°è£…è¯·æ±‚å’Œæ‰§è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯è§£æè¯­è¨€ã€‚
* ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ï¼šä¹Ÿæ˜¯ä½¿ç”¨æ ‘å½¢ç»“æ„æ¥è¡¨ç¤ºå¤æ‚å¯¹è±¡ï¼Œä½†ç»„åˆæ¨¡å¼æ›´ä¾§é‡äºæè¿°å¯¹è±¡ä¹‹é—´çš„ç»„åˆå…³ç³»ï¼Œè€Œä¸æ˜¯å®šä¹‰æ–‡æ³•è§„åˆ™ã€‚
* è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ï¼šä¹Ÿæ˜¯ä½¿ç”¨æŠ½è±¡è¡¨è¾¾å¼å’Œå…·ä½“è¡¨è¾¾å¼æ¥è¡¨ç¤ºä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä½†è®¿é—®è€…æ¨¡å¼æ›´ä¾§é‡äºå¯¹å…ƒç´ è¿›è¡Œä¸åŒç±»å‹çš„æ“ä½œï¼Œè€Œä¸æ˜¯å¯¹å…ƒç´ è¿›è¡Œç»Ÿä¸€çš„è§£é‡Šã€‚

.jdkä¸­çš„åº“ï¼Œä»¥åŠä¸€äº›ä¾‹å­
JDKä¸­æœ‰ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼çš„ä¾‹å­ï¼Œä¾‹å¦‚java.util.Patternç±»å’Œjava.text.Formatç±»ã€‚å®ƒä»¬éƒ½æä¾›äº†ä¸€ç§å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼æˆ–å¯¹è±¡çš„æ–¹æ³•ã€‚

.ç±»å›¾
[source,text]
----
+----------------+           +---------------------+
|    Context     |           |  AbstractExpression |
+----------------+           +---------------------+
|                |<>-------->| +Interpret()        |
+----------------+           +-------^-------------+
                                      |
                                      |
                                      |
                             +--------+--------+
                             |                 |
                  +--------------------+  +-----------------------+
                  | TerminalExpression |  | NonterminalExpression |
                  +--------------------+  +-----------------------+
                  | +Interpret()       |  | +Interpret()          |
                  +--------------------+  +-----------------------+
----

.ç¤ºä¾‹ä»£ç â€”â€”å¦‚ä½•å®ç°ä¸€ä¸ªè§£é‡Šå™¨æ¨¡å¼
[source,java]
----
public abstract class Expression {
    public abstract int interpret(Context context);
}

public class TerminalExpression extends Expression {
    private int number;

    public TerminalExpression(int number) {
        this.number = number;
    }

    @Override
    public int interpret(Context context) {
        return number;
    }
}

public class AddExpression extends Expression {
    private Expression left;
    private Expression right;

    public AddExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }

    @Override
    public int interpret(Context context) {
        return left.interpret(context) + right.interpret(context);
    }
}

public class SubtractExpression extends Expression {
    private Expression left;
    private Expression right;

    public SubtractExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }

    @Override
    public int interpret(Context context) {
        return left.interpret(context) - right.interpret(context);
    }
}

public class Context {
}

public class InterpreterClient {
    public static void main(String[] args) {
        Context context = new Context();
        int result = new AddExpression(
                new TerminalExpression(1),
                new SubtractExpression(
                        new TerminalExpression(2),
                        new TerminalExpression(3)
                )
        ).interpret(context);
        System.out.println(result);
    }
}
----
å¤ªé•¿çš„ç¤ºä¾‹Bingæ— æ³•å‘é€ï¼Œåé¢ä¼šä¸“é—¨æœ‰ä¸€ç¯‡æ–‡ç« è¯¦è§£è§£é‡Šå™¨æ¨¡å¼å’ŒANTLRã€‚

=== Visitor è®¿é—®è€…æ¨¡å¼
[quote]
è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒåŒ…å«è®¿é—®è€…å’Œè¢«è®¿é—®å…ƒç´ ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚è¿™äº›è¢«è®¿é—®çš„å…ƒç´ é€šå¸¸å…·æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¸”ä¸åŒçš„è®¿é—®è€…å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œä¸åŒçš„è®¿é—®æ“ä½œã€‚

.ä¼˜ç‚¹
* ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚
* ä¼˜ç§€çš„æ‰©å±•æ€§ã€‚
* çµæ´»æ€§ã€‚

.ç¼ºç‚¹
* å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿åäº†è¿ªç±³ç‰¹åŸåˆ™
* å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒå›°éš¾
* è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äº†å…·ä½“ç±»ï¼Œæ²¡æœ‰ä¾èµ–æŠ½è±¡

.é€‚ç”¨åœºæ™¯
* å¯¹è±¡ç»“æ„ä¸­å¯¹è±¡å¯¹åº”çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚
* éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œ"æ±¡æŸ“"è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚


.ç¤ºä¾‹ä»£ç 
[source,java]
----
interface Shape {
    void move(int x, int y);
    void draw();
    String accept(Visitor visitor);
}

class Circle implements Shape {
    private int id;
    private int x;
    private int y;
    private int radius;

    public Circle(int id, int x, int y, int radius) {
        this.id = id;
        this.x = x;
        this.y = y;
        this.radius = radius;
    }
    @Override
    public void move(int x, int y) {
        // move shape
    }

    @Override
    public void draw() {
        // draw shape
    }


    @Override
    public String accept(Visitor visitor) {
        return visitor.visitCircle(this);
    }

    public int getRadius() {
        return radius;
    }
}


class CompoundShape implements Shape {
   public int id;
   public List<Shape> children = new ArrayList<>();

   public CompoundShape(int id) {
       this.id = id;
   }

   @Override
   public void move(int x, int y) {
       // move shape
   }

   @Override
   public void draw() {
       // draw shape
   }

   public int getId() {
       return id;
   }

   @Override
   public String accept(Visitor visitor) {
       return visitor.visitCompoundGraphic(this);
   }

   public void add(Shape shape) {
       children.add(shape);
   }
}

public interface Visitor {
    String visitCircle(Circle circle);
    String visitCompoundGraphic(CompoundShape cg);
}

public class XMLExportVisitor implements Visitor {
    @Override
    public String visitCircle(Circle circle) {
        return "exporting circle to xml";
    }
    @Override
    public String visitCompoundGraphic(CompoundShape cg) {
        return "exporting compound graphic to xml";
    }}
}

public class Demo {
    public static void main(String[] args) {
        Circle circle = new Circle(2, 23, 15, 10);
        CompoundShape compoundShape = new CompoundShape(4);
        compoundShape.add(circle);
        compoundShape.add(rectangle);
        export(circle, compoundShape);
    }

    private static void export(Shape... shapes) {
        XMLExportVisitor exportVisitor = new XMLExportVisitor();
        System.out.println(exportVisitor.export(shapes));
    }
}
----

=== Memento å¤‡å¿˜å½•æ¨¡å¼
[quote]
å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é€‚å½“çš„æ—¶å€™æ¢å¤å¯¹è±¡ã€‚å®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚

å¤‡å¿˜å½•æ¨¡å¼é€‚ç”¨äºæ’¤é”€æ“ä½œï¼šä¿å­˜/æ¢å¤æ•°æ®çš„ç›¸å…³ä¸šåŠ¡åœºæ™¯ï¼›å¦‚ï¼šåœ¨Wordä¸­ç¼–å†™æ–‡æ¡£ï¼Œå¦‚æœæƒ³è¦æ’¤é”€ä¹‹å‰çš„è¾“å…¥/åˆ é™¤æ“ä½œï¼Œä½¿ç”¨Ctrl + Zæ‰§è¡Œâ€œæ’¤é”€â€æ“ä½œï¼›çŠ¶æ€æ¢å¤ï¼šåœ¨â€œåæ‚”â€çš„æ—¶å€™ï¼Œå°†å¯¹è±¡æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼›å¦‚ï¼šæ¸¸æˆä¸­çš„å­˜æ¡£ä½¿ç”¨ã€‚

å¤‡å¿˜å½•æ¨¡å¼ä¼˜ç‚¹æ˜¯å°è£…å­˜æ¡£ä¿¡æ¯ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ç§å¯æ¢å¤æœºåˆ¶ã€‚ç¼ºç‚¹æ˜¯èµ„æºå ç”¨ï¼Œä¼šé¢å¤–å ç”¨ç£ç›˜/å†…å­˜ç­‰èµ„æºã€‚

ä¸å¤‡å¿˜å½•æ¨¡å¼ç±»ä¼¼çš„è®¾è®¡æ¨¡å¼æœ‰çŠ¶æ€æ¨¡å¼ã€‚ä¸è¿‡ï¼Œåœ¨å¤‡å¿˜å½•æ¨¡å¼ä¸­ï¼Œä½¿ç”¨å¯¹è±¡å®ä¾‹è¡¨ç¤ºçŠ¶æ€ï¼Œå½“å‰å¯¹è±¡çš„å­˜æ¡£æ˜¯è¯¥å¯¹è±¡çš„å®ä¾‹ï¼›è€Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œä½¿ç”¨ç±»è¡¨ç¤ºçŠ¶æ€ã€‚

.ç±»å›¾
[source,text]
----
+------------------------+       +-----------------+
|   Originator           |------>|   Memento       |
+------------------------+       +-----------------+
| -state: String         |       | -state: String  |
| +setState()            |       | +getState()     |
| +saveStateToMemento()  |       |                 |
| +getStateFromMemento() |       |                 |
+------------------------+       +------+----------+
                                        |
                                        |
                                        |
                               +--------v--------+
                               |    CareTaker    |
                               +-----------------+
                               | -mementos: List |
                               | +add()          |
                               | +get()          |
                               +-----------------+
----
åœ¨è¿™ä¸ªç±»å›¾ä¸­ï¼ŒOriginatorç±»æœ‰ä¸€ä¸ªçŠ¶æ€stateï¼Œå®ƒå¯ä»¥é€šè¿‡saveStateToMemento()æ–¹æ³•å°†çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªMementoå¯¹è±¡ä¸­ï¼Œå¹¶é€šè¿‡getStateFromMemento()æ–¹æ³•ä»ä¸€ä¸ªMementoå¯¹è±¡ä¸­æ¢å¤çŠ¶æ€ã€‚CareTakerç±»è´Ÿè´£ä¿å­˜å¤šä¸ªå¤‡å¿˜å½•å¯¹è±¡ã€‚

.ç¤ºä¾‹ä»£ç 
[source,java]
----
public class Originator {
    private String state;

    public void setState(String state) {
        this.state = state;
    }

    public Memento saveStateToMemento() {
        return new Memento(state);
    }

    public void getStateFromMemento(Memento memento) {
        state = memento.getState();
    }
}

public class Memento {
    private String state;

    public Memento(String state) {
        this.state = state;
    }

    public String getState() {
        return state;
    }
}

public class CareTaker {
    private List<Memento> mementos = new ArrayList<>();

    public void add(Memento memento) {
        mementos.add(memento);
    }

    public Memento get(int index) {
        return mementos.get(index);
    }
}

public static void main(String[] args) {
    // åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªOriginatorå¯¹è±¡å’Œä¸€ä¸ªCareTakerå¯¹è±¡ã€‚æˆ‘ä»¬æ”¹å˜äº†Originatorå¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°CareTakerå¯¹è±¡ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬ä»CareTakerå¯¹è±¡ä¸­è·å–ä¿å­˜çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶æ¢å¤åˆ°Originatorå¯¹è±¡ä¸­ã€‚
    Originator originator = new Originator();
    CareTaker careTaker = new CareTaker();

    originator.setState("State #1");
    originator.setState("State #2");
    careTaker.add(originator.saveStateToMemento());

    originator.setState("State #3");
    careTaker.add(originator.saveStateToMemento());

    originator.setState("State #4");
    System.out.println("Current State: " + originator.getState());

    originator.getStateFromMemento(careTaker.get(0));
    System.out.println("First saved State: " + originator.getState());
    originator.getStateFromMemento(careTaker.get(1));
    System.out.println("Second saved State: " + originator.getState());
}
----
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒOriginatorç±»æœ‰ä¸€ä¸ªçŠ¶æ€stateï¼Œå®ƒå¯ä»¥é€šè¿‡saveStateToMemento()æ–¹æ³•å°†çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªMementoå¯¹è±¡ä¸­ï¼Œå¹¶é€šè¿‡getStateFromMemento()æ–¹æ³•ä»ä¸€ä¸ªMementoå¯¹è±¡ä¸­æ¢å¤çŠ¶æ€ã€‚CareTakerç±»è´Ÿè´£ä¿å­˜å¤šä¸ªå¤‡å¿˜å½•å¯¹è±¡ã€‚
